# PingCode OpenAPI Golang SDK 错误模型规范

> 目标：为 SDK 使用者提供统一、可预期的错误模型，使其能够可靠地区分不同类型的失败原因，并编写稳定的错误处理逻辑。

---

## 1. 错误模型设计目标

- 统一：所有领域模块复用同一套错误抽象，避免各自定义一套。
- 可判定：调用方能通过标准手段（`errors.Is/As` 等）判断错误类别。
- 不泄露敏感信息：错误中不包含 Token、密码等敏感字段。
- 可演进：在不破坏现有调用方逻辑的前提下扩展错误信息。

---

## 2. 错误分类

错误大致分为以下几类：

1. 配置错误（Configuration Error）
   - 例如：缺失 BaseURL、无效超时、认证配置不完整等。
2. 调用错误（Usage Error）
   - 例如：必填参数缺失、本地验证失败等。
3. 认证与授权错误（Auth Error）
   - 例如：Token 无效/过期、权限不足。
4. 远端业务错误（Remote Business Error）
   - PingCode API 返回的业务错误码（4xx/部分 5xx）。
5. 网络与系统错误（System/Network Error）
   - DNS 失败、连接超时、TLS 错误等。
6. 解析与协议错误（Parsing/Protocol Error）
   - 返回 JSON 格式异常、与预期协议不符等。

具体的错误类型、字段与分类规则由 SDK 内部统一实现，本规范约束其对外行为和语义。

---

## 3. 统一错误类型

### 3.1 顶层错误类型

- SDK 顶层会定义一个统一错误类型（例如 `APIError` 或等价类型）：
  - 包含至少以下信息：
    - HTTP 状态码（如有）；
    - PingCode 业务错误码（如有）；
    - 人类可读的错误消息；
    - 可选的请求 ID 或 Trace ID（用于排查问题）。
- 该错误类型必须实现 `error` 接口，并支持 `errors.Is/As`。

### 3.2 包装与透传

- 配置错误和调用错误通常通过 Go 原生错误或特定错误类型暴露：
  - 例如：`ErrInvalidConfig` 等。
- 网络错误和解析错误可以透传底层错误，但必须包裹在统一错误体系中，以便调用方区分。

---

## 4. 错误判定与处理模式

### 4.1 标准库模式

- 所有错误判定鼓励使用标准库模式：
  - `errors.Is(err, targetErr)`
  - `errors.As(err, &targetType)`
- SDK 不提供自定义的错误判定助手函数，避免重复发明轮子。

### 4.2 推荐的调用方处理逻辑

- 调用方应按如下优先级处理错误：
  1. 判断是否为配置/调用错误，属于编程错误，应在开发阶段修复；
  2. 判断是否为认证错误，提示用户检查凭证或尝试刷新；
  3. 判断是否为业务错误，根据业务错误码进行分支处理；
  4. 判断是否为网络/系统错误，根据场景决定是否重试；
  5. 其余未知错误记录日志并报警。

---

## 5. 错误与重试策略

- 错误类型与重试策略必须严格解耦：
  - SDK 内部可根据错误类别决定是否自动重试，但不得隐藏最终错误原因；
  - 调用方应始终能够看见“最终发生了什么”，而不是只看到一个模糊的包装错误。
- 对哪些错误可以安全重试、哪些不可以，需要在后续实现中给出清单，并在文档中说明。

---

## 6. 向后兼容性要求

- 一旦错误类型和分类规则对外公开：
  - 不得随意变更已有错误值的语义；
  - 不得在未经过 MAJOR 版本升级的情况下移除已公开的错误类型或错误值。
- 新增错误类型或错误字段时：
  - 必须保证不会破坏基于现有错误处理逻辑的调用方代码。

---

## 7. 文档与示例

- 错误模型的关键部分必须在 SDK 文档中展示：
  - 常见错误分类；
  - 调用方如何处理错误的示例代码；
  - 典型场景（如认证失败、配额超限等）的错误示例。
- 示例必须使用标准库错误处理方式，不引入额外封装。

